
# Инструкция по сборке приложений и модулей ядра Linux (MIPS)

Сборка приложений и модулей осуществляется с использованием предоставленной
структуры каталогов и файлов, которая существует в директории
**angtel-projects** проекта **netprog2**. Ниже приводится описание организации
этой директории, а также последовательность шагов, выполнение которых
необходимо для корректной сборки приложений и модулей.

## Подготовительные операции

Прежде чем приступить к сборке приложений и модулей необходимо скопировать
директорию **angtel-projects** в свой домашний каталог. Для этого необходимо,
прежде всего, определить где находится директория **netprog2** относительно
корневого каталога (**/**). В директории **netprog2** содержатся исходные файлы
проекта. Определив указанный путь (назовем его path_to_netprog2),
выполните приведенные ниже команды:

```console
$ cp -R /path_to_netprog2/build/angtel-projects ~/
$ cd ~/angtel-projects
```

После выполнения указанных команд Вы окажетесь в директории
**angtel-projects**, расположенной в домашнем каталоге.

## Структура каталогов

В директории **angtel-projects** содержаться каталоги с названиями **lab-XX** и
**exercise-XX-Y**. В каталогах первого типа выполняются лабораторные работы,
в каталогах второго типа - упражнения к лабораторным работам. Также в
директории **angtel-projects** находится общий для всех типов работ makefile,
который называется **common&#46;mk**.

Рассмотрим структуру каталога **lab-XX**. Для каталога **exercise-XX-Y** она
является аналогичной. В каталоге **lab-XX** располагаются исходные и
заголовочные файлы. Помимо этого, в каталоге **lab-XX** имеется частный
makefile с именем **Makefile**. Частный makefile содержит следующую информацию:

```make
APP_NAME ::= lab-01

MAIN_MAKEFILE ::= ../common.mk

ifneq ($(KERNELRELEASE),)
MAIN_MAKEFILE ::= $(M)/$(MAIN_MAKEFILE)
endif

include $(MAIN_MAKEFILE)
```

Здесь **APP_NAME** это имя исполняемого файла, получающегося в результате
сборки приложения. При сборке модуля ядра Linux **APP_NAME** следует заменить
на **MOD_NAME**. **MAIN_MAKEFILE** - путь к общему makefile относительно
каталога **lab-XX**.

## Алгоритм сборки

1. Перейти в каталог **lab-XX**.

    ```console
    $ cd ~/angtel-projects/lab-XX
    ```

2. Поместить файлы с исходным кодом (*.c) в текущий каталог.

3. Поместить (если нужно) заголовочные файлы (*.h) в текущий каталог.

4. Задать в частном makefile с именем **Makefile**, который находится в текущем
   каталоге, желаемое имя исполняемого файла или имя модуля. Для этого
   необходимо установить для переменной **APP_NAME** или **MOD_NAME**
   соответствующее значение.

5. Собрать исполняемый файл или модуль.

    ```console
    $ make
    ```

6. Записать исполняемый файл или модуль на плату.

    ```console
    $ make install
    ```

## Дополнительные действия

1. Очистка директории от файлов, появившихся во время сборки.

    ```console
    $ make clean
    ```

2. Удаление исполняемого файла или модуля с платы.

    ```console
    $ make uninstall
    ```

3. Вывод списка доступных действий.

    ```console
    $ make help
    ```

# Инструкция по сборке и запуску приложений (x86)

Ниже приводится последовательность шагов для сборки приложений
под архитектуру **x86** и их запуска.

Введем следующие обозначения:

- **DIR_HDRS** - путь к директории с заголовочными файлами;
- **DIR_LIBS** - путь к директории с библиотеками;
- **LIB_NAME** - имя библиотеки без префикса *lib*;
- **SRCS** - множество файлов с исходным кодом (*.c);
- **APP_NAME** - имя исполняемого файла.

## Стандартное расположение заголовочных файлов и библиотек

Команда для сборки программы:

```console
$ gcc SRCS -o APP_NAME
```

Команда для запуска программы:

```console
$ ./APP_NAME
```

## Нестандартное расположение заголовочных файлов и библиотек

### Сборка приложения

1. С помощью опции **-I** задать путь к директории с заголовочными файлами.

2. С помощью опции **-L** задать путь к директории с библиотеками.

3. С помощью опции **-l** задать имя библиотеки без префикса *lib*.

4. Выполнить команду:

    ```console
    $ gcc [-IDIR_HDRS ...] [-LDIR_LIBS ...] SRCS [-lLIB_NAME ...] -o APP_NAME
    ```

    Необходимо отметить, что после опций **-I**, **-L** и **-l**
    пробелы не ставятся.

Подробнее см. man-страницу [gcc(1)][1].

[1]: http://www.opennet.ru/man.shtml?topic=gcc&category=1&russian=2

### Запуск приложения

Для запуска приложения, собранного с нестандартным расположением библиотек
необходимо использовать переменную окружения **LD_LIBRARY_PATH**. В качестве
значения данной переменной необходимо указать список директорий, разделенных
символом двоеточия, в которых следует производить поиск файлов библиотек.
Стоит отметить, что поиск файлов библиотек будет сначала осуществляться в
указанных директориях и только потом в стандартных расположениях.

Команда для запуска приложения:

```console
$ LD_LIBRARY_PATH=DIR_HDRS ./APP_NAME
```

## Сборка библиотеки libubox

Вариант №1:

```console
$ git clone https://github.com/pavel-angtel/libubox.git
$ cd ./libubox
$ cmake . -DBUILD_EXAMPLE=OFF -DBUILD_LUA=OFF
$ make
$ make install
```

Для установки файлов библиотеки могут потребоваться привилегии.

После этого собрать программу с использованием стандартного расположения
заголовочных файлов и библиотек. Предполагается, что каталог */usr/local/lib*
включен в число стандартных расположений.

Вариант №2:

```console
$ git clone https://github.com/pavel-angtel/libubox.git
$ cd ./libubox
$ cmake . -DBUILD_EXAMPLE=OFF -DBUILD_LUA=OFF
$ make
```

После этого собрать программу с использованием нестандартного расположения
заголовочных файлов и библиотек.
